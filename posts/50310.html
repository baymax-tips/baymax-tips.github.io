<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="Docker入门系列  3. Docker 容器网络的概念及网络配置 网络概述"><meta name="description" content=""><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-167468047-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-167468047-1")</script><title>Docker入门系列 3. Docker 容器网络的概念及网络配置 网络概述 | 小白笔记</title><link rel="icon" type="image/png" href="/favicon.png"><link rel="stylesheet" href="/libs/awesome/css/all.css"><link rel="stylesheet" href="/libs/materialize/materialize.min.css"><link rel="stylesheet" href="/libs/aos/aos.css"><link rel="stylesheet" href="/libs/animate/animate.min.css"><link rel="stylesheet" href="/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="/css/matery.css"><link rel="stylesheet" href="/css/my.css"><script src="/libs/jquery/jquery.min.js"></script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="小白笔记" type="application/atom+xml"><link rel="stylesheet" href="/css/prism-tomorrow.css"><link rel="stylesheet" href="/css/prism-line-numbers.css"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><div><img src="/medias/loading.gif" data-original="/medias/logo.png" class="logo-img" alt="LOGO"> <span class="logo-span">小白笔记</span></div></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fas fa-tags" style="zoom:.6"></i> <span>标签</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>分类</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>归档</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>关于</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fas fa-comments" style="zoom:.6"></i> <span>留言板</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-address-book" style="zoom:.6"></i> <span>友情链接</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="/medias/loading.gif" data-original="/medias/logo.png" class="logo-img circle responsive-img"><div class="logo-name">小白笔记</div><div class="logo-desc">Never really desperate, only the lost of the soul.</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> 标签</a></li><li class="m-nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> 分类</a></li><li class="m-nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> 归档</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于</a></li><li class="m-nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fa-fw fas fa-comments"></i> 留言板</a></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> 友情链接</a></li><li><div class="divider"></div></li><li><a href="https://github.com/baymax-tips" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i> Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/baymax-tips" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(/medias/featureimages/10.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">Docker入门系列 3. Docker 容器网络的概念及网络配置 网络概述</h1></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="/libs/tocbot/tocbot.css"><style>#articleContent h1::before,#articleContent h2::before,#articleContent h3::before,#articleContent h4::before,#articleContent h5::before,#articleContent h6::before{display:block;content:" ";height:100px;margin-top:-100px;visibility:hidden}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{width:345px;padding-left:20px}.toc-widget .toc-title{margin:35px 0 15px 0;padding-left:17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content{height:calc(100vh - 250px);overflow:auto}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px;position:absolute;right:23.5vw;display:block}#toc-content .is-active-link{color:#42b983}#floating-toc-btn{position:fixed;right:15px;bottom:76px;padding-top:15px;margin-bottom:0;z-index:998}#floating-toc-btn .btn-floating{width:48px;height:48px}#floating-toc-btn .btn-floating i{line-height:48px;font-size:1.4rem}</style><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/Docker/"><span class="chip bg-color">Docker</span></a> <a href="/tags/%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1/"><span class="chip bg-color">容器服务</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1/" class="post-category">容器服务</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> 发布日期:&nbsp;&nbsp; 2020-05-14</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i> 文章字数:&nbsp;&nbsp; 3.8k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i> 阅读时长:&nbsp;&nbsp; 14 分</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i> 阅读次数:&nbsp;&nbsp;<span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><div class="card-content article-card-content"><div id="articleContent"><h2 id="1-网络概述"><a href="#1-网络概述" class="headerlink" title="1. 网络概述"></a>1. 网络概述</h2><p>  Docker容器和服务如此强大的原因之一是你可以将它们连接在一起，或将它们连接到非Docker工作负载。Docker容器和服务甚至不需要知道它们已部署在Docker上，也不必知道它们的对等对象是否也是Docker工作负载。无论您的Docker主机运行Linux，Windows还是两者结合，您都可以使用Docker以与平台无关的方式管理它们。</p><p>本主题定义了一些基本的 Docker 网络概念，并帮助您设计和部署应用程序以充分利用这些功能</p><p>这些内容大多适用于所有的 Docker 安装。 然而，一些高级功能仅适用于Docker 企业版客户。</p><h3 id="1-1-网络驱动"><a href="#1-1-网络驱动" class="headerlink" title="1.1 网络驱动"></a>1.1 网络驱动</h3><p>Docker的网络子系统可使用驱动程序插拔式接入。默认情况下，有几个驱动程序，它们提供核心联网功能：</p><ul><li><p><code>bridge</code>：<code>网桥网络</code> 默认的网络驱动程序。如果您没有指定驱动程序，那么这就是您正在创建的网络类型。桥接网络通常在应用程序运行在需要通信的独立容器中时使用。</p></li><li><p><code>host</code>：<code>主机网络</code> 对于独立容器，请删除容器与Docker主机之间的网络隔离，然后直接使用主机的网络。host 仅可用于Docker 17.06及更高版本上的集群服务。</p></li><li><p><code>overlay</code>：<code>覆盖网络</code> 将多个 Docker 守护进程连接在一起，使群服务能够相互通信。 您还可以使用覆盖网络来促进群服务和独立容器之间的通信，或者在不同的 Docker 守护进程上的两个独立容器之间的通信。 这种策略消除了在这些容器之间执行操作系统级路由的需要。</p></li><li><p><code>macvlan</code>：<code>Macvlan网络</code>网络允许你为容器分配 MAC 地址，使它看起来像是你网络上的一个物理设备。 Docker 守护进程通过容器的 MAC 地址将流量路由到容器。 在处理希望直接连接到物理网络的遗留应用程序时，使用 macvlan 驱动程序有时是最佳选择，而不是通过 Docker 主机的网络栈进行路由。</p></li><li><p><code>none</code>：对于此容器，禁用所有联网。通常与自定义网络驱动程序一起使用。none不适用于群体服务。请参阅 禁用容器联网。</p></li><li><p><code>网络插件</code>：您可以在Docker上安装和使用第三方网络插件。这些插件可从 Docker Hub 或第三方供应商处获得。有关安装和使用给定网络插件的信息，请参阅供应商的文档。</p></li></ul><h4 id="网络驱动程序摘要"><a href="#网络驱动程序摘要" class="headerlink" title="网络驱动程序摘要"></a>网络驱动程序摘要</h4><ul><li>当您需要多个容器在同一Docker主机上进行通信时，最好使用用户定义的<code>网桥网络</code>。</li><li>当网络堆栈不应与Docker主机隔离时，但您希望容器的其他方面隔离时，<code>主机网络</code>是最佳选择。</li><li>当您需要在不同Docker主机上运行的容器进行通信时，或者当多个应用程序使用集群服务一起工作时，<code>覆盖网络</code>是最好的。</li><li>从VM设置迁移或需要容器看起来像网络上的物理主机（每个主机都有唯一的MAC地址）时，<code>Macvlan网络</code>是最好的。</li><li>第三方网络插件使您可以将Docker与专用网络堆栈集成。</li></ul><h3 id="1-2-Docker-EE网络功能"><a href="#1-2-Docker-EE网络功能" class="headerlink" title="1.2 Docker EE网络功能"></a>1.2 Docker EE网络功能</h3><p>以下两个功能仅在使用Docker 企业版和使用通用控制平面（UCP）管理Docker服务时才可用：</p><ul><li><p><code>HTTP路由网格</code> 可以让你分享多个服务之间的相同的网络IP地址和端口。根据客户端的请求，UCP使用主机名和端口的组合将流量路由到适当的服务。</p></li><li><p><code>会话粘性</code> 使您可以在HTTP标头中指定UCP用于需要状态会话的应用程序将后续请求路由到同一服务任务的信息。</p></li></ul><h2 id="2-容器网络"><a href="#2-容器网络" class="headerlink" title="2. 容器网络"></a>2. 容器网络</h2><p>容器使用的网络类型，无论是桥接、覆盖、 macvlan 网络还是定制网络插件，都是从容器内部透明的。 从容器的角度来看，它有一个具有 IP 地址、网关、路由表、 DNS 服务和其他网络详细信息的网络接口(假设容器没有使用 none 网络驱动程序)。</p><h3 id="2-1-发布端口"><a href="#2-1-发布端口" class="headerlink" title="2.1 发布端口"></a>2.1 发布端口</h3><p>默认情况下，当您创建一个容器时，它不会向外部世界发布它的任何端口。 若要使一个端口可用于 Docker 以外的服务，或未连接到容器网络的 Docker 容器，请使用 – publish 或-p 标志。 这将创建一个防火墙规则，该规则将容器端口映射到 Docker 主机上的端口。 下面是一些例子。</p><table><thead><tr><th align="center">标志值</th><th align="left">描述</th></tr></thead><tbody><tr><td align="center">-p 8080:80</td><td align="left">将容器中的 TCP 端口80映射到 Docker 主机上的端口8080</td></tr><tr><td align="center">-p 192.168.1.100:8080:80</td><td align="left">将容器中的 TCP 端口80映射到 Docker 主机上的端口8080，以连接到主机 IP 192.168.1.100</td></tr><tr><td align="center">-p 8080:80/udp</td><td align="left">将容器中的 UDP 端口80映射到 Docker 主机上的8080端口</td></tr><tr><td align="center">-p 8080:80/tcp -p 8080:80/udp</td><td align="left">将容器中的 TCP 端口80映射到 Docker 主机上的 TCP 端口8080，并将容器中的 UDP 端口80映射到 Docker 主机上的 UDP 端口8080</td></tr></tbody></table><h3 id="2-2-IP地址和主机名"><a href="#2-2-IP地址和主机名" class="headerlink" title="2.2 IP地址和主机名"></a>2.2 IP地址和主机名</h3><p>默认情况下，容器为它连接的每个 Docker 网络分配一个 IP 地址。 Ip 地址是从分配给网络的池中分配的，因此 Docker 守护进程有效地充当每个容器的 DHCP 服务器。 每个网络还有一个默认的子网掩码和网关。</p><p>当容器启动时，它只能使用 <code>--network</code> 连接到单个网络。 但是，可以使用 <code>docker network connect</code> 将正在运行的容器连接到多个网络。 当使用 <code>--network</code> 标志启动容器时，可以使用 <code>--ip</code> 或 <code>--ip6</code> 标志指定分配给该网络上的容器的 IP 地址。</p><p>当您使用 <code>docker newwork connect</code>将现有容器连接到另一个网络时，您可以使用该命令上的 <code>--ip</code> 或 <code>--ip6</code> 标志来指定容器在附加网络上的 IP 地址。</p><p>同样，容器的主机名默认为 Docker 中容器的 ID。 您可以使用 <code>--hostname</code> 覆盖主机名。 当使用 <code>docker newwork connect</code> 连接到现有网络时，可以使用 <code>--alias</code> 标志为该网络上的容器指定一个额外的网络别名。</p><h3 id="2-3-DNS服务"><a href="#2-3-DNS服务" class="headerlink" title="2.3 DNS服务"></a>2.3 DNS服务</h3><p>默认情况下，容器继承 Docker 守护进程的 DNS 设置，包括 <code>/etc/hosts</code> 和 <code>/etc/resolv.conf</code>。你可以根据每个容器重写这些设置。</p><table><thead><tr><th align="center">标志值</th><th align="left">描述</th></tr></thead><tbody><tr><td align="center">–dns</td><td align="left">DNS服务器的IP地址。要指定多个DNS服务器，请使用多个–dns标志。如果容器无法访问您指定的任何IP地址，8.8.8.8则会添加Google的公共DNS服务器，以便您的容器可以解析Internet域。</td></tr><tr><td align="center">–dns-searc</td><td align="left">一个DNS搜索域，用于搜索非完全限定的主机名。要指定多个DNS搜索前缀，请使用多个–dns-search标志。</td></tr><tr><td align="center">–dns-opt</td><td align="left">代表DNS选项及其值的键/值对</td></tr><tr><td align="center">–hostname</td><td align="left">容器本身使用的主机名。如果未指定，则默认为容器的ID。</td></tr></tbody></table><h3 id="2-4-代理服务器"><a href="#2-4-代理服务器" class="headerlink" title="2.4 代理服务器"></a>2.4 代理服务器</h3><p>如果你的容器需要使用 HTTP，HTTPS，或者 FTP 代理服务器，你可以用不同的方式配置它:</p><ul><li><p>在Docker 17.07及更高版本中，您可以 配置Docker客户端以将代理信息自动传递到容器。</p></li><li><p>在Docker 17.06及更低版本中，您必须 在容器内设置适当的环境变量。您可以在构建映像时执行此操作（这会降低映像的可移植性），或者在创建或运行容器时执行此操作</p></li></ul><h4 id="配置-Docker-客户机"><a href="#配置-Docker-客户机" class="headerlink" title="配置 Docker 客户机"></a>配置 Docker 客户机</h4><ol><li><p>在 Docker 客户机上，创建或编辑文件 <code>~/.Docker/config</code>. 在启动容器的用户的主目录中。 添加如下所示的 JSON，必要时用 <code>httpsProxy</code> 或 <code>ftpProxy</code> 替换代理类型，并替换代理服务器的地址和端口。 您可以同时配置多个代理服务器。</p><p>通过将 noProxy 键设置为一个或多个逗号分隔的 IP 地址或主机，可以有选择地排除主机或范围，使其无法通过代理服务器。 支持使用 * 字符作为通配符，如本例所示。</p><pre><code>{
 "proxies":
     {
         "default":
         {
             "httpProxy": "http://127.0.0.1:3001",
             "httpsProxy": "http://127.0.0.1:3001",
             "noProxy": "*.test.example.com,.example2.com"
         }
     }
 }</code></pre><p>保存文件</p></li><li><p>在创建或启动新容器时，环境变量将在容器中自动设置。</p></li></ol><h4 id="使用环境变量"><a href="#使用环境变量" class="headerlink" title="使用环境变量"></a>使用环境变量</h4><p>在构建映像时，或者在创建或运行容器时使用 <code>--env</code> 标志时，可以将以下一个或多个变量设置为适当的值。 这种方法降低了图像的可移植性，因此如果您使用的是 Docker 17.07或更高版本，则应该配置 Docker 客户机。</p><table><thead><tr><th align="center">变量</th><th align="left">Dockfile示例</th><th align="left">docker run示例</th></tr></thead><tbody><tr><td align="center">HTTP_PROXY</td><td align="left">ENV HTTP_PROXY “<a href="http://127.0.0.1:3001&quot;">http://127.0.0.1:3001"</a></td><td align="left">–env HTTP_PROXY=”<a href="http://127.0.0.1:3001&quot;">http://127.0.0.1:3001"</a></td></tr><tr><td align="center">HTTPS_PROXY</td><td align="left">ENV HTTPS_PROXY “<a href="https://127.0.0.1:3001&quot;">https://127.0.0.1:3001"</a></td><td align="left">–env HTTPS_PROXY=”<a href="https://127.0.0.1:3001&quot;">https://127.0.0.1:3001"</a></td></tr><tr><td align="center">FTP_PROXY</td><td align="left">ENV FTP_PROXY “<a href="ftp://127.0.0.1:3001&quot;">ftp://127.0.0.1:3001"</a></td><td align="left">–env FTP_PROXY=”<a href="ftp://127.0.0.1:3001&quot;">ftp://127.0.0.1:3001"</a></td></tr><tr><td align="center">NO_PROXY</td><td align="left">ENV NO_PROXY “*.test.example.com,.example2.com”</td><td align="left">–env NO_PROXY=”*.test.example.com,.example2.com”</td></tr></tbody></table><h3 id="2-5-启用IPv6支持"><a href="#2-5-启用IPv6支持" class="headerlink" title="2.5 启用IPv6支持"></a>2.5 启用IPv6支持</h3><p>在 Docker 容器或群服务中使用 IPv6之前，需要在 Docker 守护进程中启用 IPv6支持。 之后，您可以选择对任何容器、服务或网络使用 IPv4或 IPv6(或者两者都使用)。</p><blockquote><p><strong>注意: IPv6网络只支持在 Linux 主机上运行的 Docker 守护进程。</strong></p></blockquote><ol><li>编辑 <code>/etc/docker/daemon.json</code> 并将 <code>ipv6</code>键设置为 <code>true</code>。</li></ol><pre class="line-numbers language-bash"><code class="language-bash"><span class="token punctuation">{</span>
  <span class="token string">"ipv6"</span><span class="token keyword">:</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>保存文件</p><ol start="2"><li>重新加载 Docker 配置文件。</li></ol><pre class="line-numbers language-bash"><code class="language-bash">$ systemctl reload docker<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>现在您可以使用 <code>--ipv6</code> 标志创建网络，并使用 <code>--ip6</code> 标志分配容器的 IPv6 地址。</p><h3 id="2-6-Docker-和-iptables"><a href="#2-6-Docker-和-iptables" class="headerlink" title="2.6 Docker 和 iptables"></a>2.6 Docker 和 iptables</h3><p>在 Linux 上，Docker 操纵 iptables 规则来提供网络隔离。 虽然这是一个实现细节，你不应该修改 Docker 插入到你的 iptables 策略中的规则，但是如果你想在 Docker 管理的策略之外还有自己的策略，它确实会对你需要做的事情产生一些影响。</p><p>如果您正在一个公开到 Internet 的主机上运行 Docker，那么您可能希望将 iptables 策略放在适当的位置，以防止对在您的主机上运行的容器或其他服务的未经授权的访问。 本页描述了如何实现这一点，以及需要注意的事项。</p><h4 id="在-Docker-规则之前添加-iptables-策略"><a href="#在-Docker-规则之前添加-iptables-策略" class="headerlink" title="在 Docker 规则之前添加 iptables 策略"></a>在 Docker 规则之前添加 iptables 策略</h4><p>Docker 安装了两个自定义 iptables 链，分别名为 Docker-user 和 Docker，它确保传入的数据包总是首先由这两个 iptables 链检查。</p><p>Docker 的所有 iptables 规则都添加到 Docker 链中。 不要手动操作此链。 如果需要在 Docker 的规则加载之前添加规则，请将它们添加到 Docker-user 链中。 这些规则在 Docker 自动创建任何规则之前被应用。</p><p>添加到 FORWARD 链中的规则——手动地，或者由另一个基于 iptables 的防火墙——在这些链之后进行评估。 这意味着，如果您通过 Docker 公开一个端口，那么无论您的防火墙配置了什么规则，该端口都会公开。 如果希望即使在通过 Docker 公开端口时也应用这些规则，则必须将这些规则添加到 Docker-user 链中。</p><h5 id="限制与-Docker-主机的连接"><a href="#限制与-Docker-主机的连接" class="headerlink" title="限制与 Docker 主机的连接"></a>限制与 Docker 主机的连接</h5><p>默认情况下，所有外部源 ip 都允许连接到 Docker 主机。 若要只允许特定的 IP 或网络访问容器，请在 DOCKER-USER 过滤器链的顶部插入否定规则。 例如，以下规则限制除192.168.1.1以外的所有 IP 地址的外部访问:</p><pre class="line-numbers language-bash"><code class="language-bash">$ iptables -I DOCKER-USER -i ext_if <span class="token operator">!</span> -s 192.168.1.1 -j DROP<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>请注意，如果要符合主机的实际外部接口，则需要更改 ext。 您可以改为允许来自源子网的连接。 以下规则只允许从子网192.168.1.0 / 24访问:</p><pre class="line-numbers language-bash"><code class="language-bash">$ iptables -I DOCKER-USER -i ext_if <span class="token operator">!</span> -s 192.168.1.0/24 -j DROP<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>最后，您可以使用 – src-range 指定一个要接受的 IP 地址范围(记住在使用 – src-range 或 – dst-range 时也要添加-m iprange) :</p><pre class="line-numbers language-bash"><code class="language-bash">$ iptables -I DOCKER-USER -m iprange -i ext_if <span class="token operator">!</span> --src-range 192.168.1.1-192.168.1.3 -j DROP<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>您可以将-s 或 – src-range 与-d 或 – dst-range 组合起来，以控制源和目标。 例如，如果 Docker 守护进程同时监听192.168.1.99和10.1.2.3，您可以制定特定于10.1.2.3的规则，并保持192.168.1.99处于开放状态。</p><p>Iptables 比较复杂，而且更复杂的规则超出了本主题的范围。 更多信息请参见 netfilter. org HOWTO。</p><h3 id="路由器上的-Docker"><a href="#路由器上的-Docker" class="headerlink" title="路由器上的 Docker"></a>路由器上的 Docker</h3><p>Docker 还为 FORWARD 链设置 DROP 策略。 如果你的 Docker 主机也作为一个路由器，这将导致该路由器不再转发任何流量。 如果您希望您的系统继续发挥路由器的功能，可以向 DOCKER-USER 链添加显式的 ACCEPT 规则以允许它:</p><pre class="line-numbers language-bash"><code class="language-bash">$ iptables -I DOCKER-USER -i src_if -o dst_if -j ACCEPT<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="防止-Docker-操纵-iptables"><a href="#防止-Docker-操纵-iptables" class="headerlink" title="防止 Docker 操纵 iptables"></a>防止 Docker 操纵 iptables</h3><p>在 <code>/etc/Docker/daemon.json</code> 的 Docker 引擎配置文件中，可以将 iptables 键设置为 false。 但是这个选项并不适合大多数用户。 完全阻止 Docker 创建 iptables 规则是不可能的，并且在事后创建这些规则非常复杂，超出了本说明的范围。 将 iptables 设置为 false 很可能会破坏 Docker 引擎的容器网络。</p><h3 id="设置容器的默认绑定地址"><a href="#设置容器的默认绑定地址" class="headerlink" title="设置容器的默认绑定地址"></a>设置容器的默认绑定地址</h3><p>默认情况下，Docker 守护进程将在0.0.0.0地址上公开端口，即主机上的任何地址。 如果希望更改该行为以便只公开内部 IP 地址上的端口，可以使用 <code>--ip</code> 选项指定不同的 IP 地址。 但是，设置 <code>--ip</code> 只改变默认值，它不将服务限制在该 IP 上。</p><h2 id="3-禁用容器联网"><a href="#3-禁用容器联网" class="headerlink" title="3. 禁用容器联网"></a>3. 禁用容器联网</h2><p>如果希望完全禁用容器上的网络堆栈，可以在启动容器时使用 <code>--network none</code> 标志。 在容器中，只创建环回设备。 下面的例子说明了这一点。</p><ol><li>创建容器</li></ol><pre class="line-numbers language-bash"><code class="language-bash">$ docker run --rm -dit \
  --network none \
  --name no-net-alpine \
  alpine:latest \
  ash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol start="2"><li>通过在容器中执行一些常见的网络命令来检查容器的网络堆栈。</li></ol><pre class="line-numbers language-bash"><code class="language-bash">$ docker <span class="token function">exec</span> no-net-alpine ip <span class="token function">link</span> show

1: lo: <span class="token operator">&lt;</span>LOOPBACK,UP,LOWER_UP<span class="token operator">></span> mtu 65536 qdisc noqueue state UNKNOWN qlen 1
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
2: tunl0@NONE: <span class="token operator">&lt;</span>NOARP<span class="token operator">></span> mtu 1480 qdisc noop state DOWN qlen 1
    link/ipip 0.0.0.0 brd 0.0.0.0
3: ip6tnl0@NONE: <span class="token operator">&lt;</span>NOARP<span class="token operator">></span> mtu 1452 qdisc noop state DOWN qlen 1
    link/tunnel6 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00 brd 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash"><code class="language-bash">$ docker <span class="token function">exec</span> no-net-alpine ip route<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>第二个命令返回空，因为没有路由表。</p><ol start="3"><li>停止容器。它会自动删除，因为它是用 – rm 标志创建的。</li></ol><pre class="line-numbers language-bash"><code class="language-bash">$ docker container <span class="token function">rm</span> no-net-alpine<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><script>document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });</script></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者:</i></span> <span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">Baymax</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接:</i></span> <span class="reprint-info"><a href="https://baymax.tips/posts/50310.html">https://baymax.tips/posts/50310.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明:</i></span> <span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">Baymax</a> !</span></div></div><script async defer>document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/Docker/"><span class="chip bg-color">Docker</span></a> <a href="/tags/%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1/"><span class="chip bg-color">容器服务</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/libs/share/js/social-share.min.js"></script></div></div></div><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.4rem;line-height:38px}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .close:hover{color:#ef5350;transform:scale(1.3);-moz-transform:scale(1.3);-webkit-transform:scale(1.3);-o-transform:scale(1.3)}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-content ul{padding-left:0!important}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{background-color:#ccc;color:#fff}.reward-tabs .wechat-tab .active{color:#fff!important;background-color:#22ab38!important}.reward-tabs .alipay-tab .active{color:#fff!important;background-color:#019fe8!important}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="/medias/loading.gif" data-original="/medias/reward/alipay.png" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="/medias/loading.gif" data-original="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><link rel="stylesheet" href="/libs/gitalk/gitalk.css"><link rel="stylesheet" href="/css/my-gitalk.css"><div class="card gitalk-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="gitalk-container" class="card-content"></div></div><script src="/libs/gitalk/gitalk.min.js"></script><script>let gitalk = new Gitalk({
        clientID: '409bf7f6a2a9bcc0f9e6',
        clientSecret: '1cafe266ac7e32c87692df3d52b9a16b773e8c31',
        repo: 'baymax-tips.github.io',
        owner: 'baymax-tips',
        admin: "baymax-tips",
        id: '2020-05-14T19-45-42',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i> &nbsp;上一篇</div><div class="card"><a href="/posts/27457.html"><div class="card-image"><img src="/medias/loading.gif" data-original="/medias/featureimages/21.jpg" class="responsive-img" alt="Docker入门系列  4. Docker 容器网络的概念及网络配置 网桥网络"> <span class="card-title">Docker入门系列 4. Docker 容器网络的概念及网络配置 网桥网络</span></div></a><div class="card-content article-content"><div class="summary block-with-text">1. 使用网桥网络就网络而言，桥接网络是在网段之间转发流量的链路层设备。桥接器可以是在主机内核中运行的硬件设备或软件设备。 就 Docker 而言，桥接网络使用一个软件桥接器，它允许连接到同一桥接网络的容器进行通信，同时提供与未连接到桥接网</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2020-05-22</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1/" class="post-category">容器服务</a></span></div></div><div class="card-action article-tags"><a href="/tags/Docker/"><span class="chip bg-color">Docker</span></a> <a href="/tags/%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1/"><span class="chip bg-color">容器服务</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/posts/17098.html"><div class="card-image"><img src="/medias/loading.gif" data-original="/medias/featureimages/0.jpg" class="responsive-img" alt="Docker 入门系列  2. Docker 核心概念和安装使用"> <span class="card-title">Docker 入门系列 2. Docker 核心概念和安装使用</span></div></a><div class="card-content article-content"><div class="summary block-with-text">一、 核心概念：镜像、容器与仓库Docker 主要包含三个核心概念，分别是镜像、容器和仓库，理解了这三个概念，就理解了 Docker 的整个生命周期。 镜像： Docker 镜像是一个特殊的文件系统，除了提供容器运行时所需的程序、库、资源</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2020-05-13</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1/" class="post-category">容器服务</a></span></div></div><div class="card-action article-tags"><a href="/tags/Docker/"><span class="chip bg-color">Docker</span></a> <a href="/tags/%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1/"><span class="chip bg-color">容器服务</span></a></div></div></div></div></article></div><script src="/libs/codeBlock/codeBlockFuction.js"></script><script src="/libs/codeBlock/codeLang.js"></script><script src="/libs/codeBlock/codeCopy.js"></script><script src="/libs/codeBlock/codeShrink.js"></script><style>code[class*=language-],pre[class*=language-]{white-space:pre!important}</style></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="/libs/tocbot/tocbot.min.js"></script><script>$(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });</script></main><footer class="page-footer bg-color"><link rel="stylesheet" href="/libs/aplayer/APlayer.min.css"><style>.aplayer .aplayer-lrc p{display:none;font-size:12px;font-weight:700;line-height:16px!important}.aplayer .aplayer-lrc p.aplayer-lrc-current{display:none;font-size:15px;color:#42b983}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><div><div class="row"><meting-js class="col l8 offset-l2 m10 offset-m1 s12" server="netease" type="playlist" id="503838841" fixed="true" autoplay theme="#42b983" loop order="random" preload="auto" volume="0.7" list-folded="true"></meting-js></div></div><script src="/libs/aplayer/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><div class="container row center-align" style="margin-bottom:0!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2019</span> <a href="/about" target="_blank">Baymax</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br><span id="busuanzi_container_site_pv">|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span>&nbsp;次</span> <span id="busuanzi_container_site_uv">|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span>&nbsp;人</span><br><br></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/baymax-tips" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i></a><a href="mailto:baymax.tips@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1104559822" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1104559822" data-position="top" data-delay="50"><i class="fab fa-qq"></i></a><a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i> &nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script src="/js/search.js"></script><script>$(function(){searchFunc("/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="/libs/materialize/materialize.min.js"></script><script src="/libs/masonry/masonry.pkgd.min.js"></script><script src="/libs/aos/aos.js"></script><script src="/libs/scrollprogress/scrollProgress.min.js"></script><script src="/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?0c003470f128eba63e9f505647bc17bd";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/libs/others/clicklove.js" async></script><script async src="/libs/others/busuanzi.pure.mini.js"></script><script src="/libs/background/ribbon-dynamic.js" async></script><script src="/libs/instantpage/instantpage.js" type="module"></script><script>window.imageLazyLoadSetting={isSPA:!1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(n){n.imageLazyLoadSetting.processImages=i;var e=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=r[a].getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight+240||document.documentElement.clientHeight+240)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e()},n.src=i}()}i(),n.addEventListener("scroll",function(){var t,e;t=i,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script></body></html>