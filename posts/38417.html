<!DOCTYPE HTML><html lang="zh-CN"><head><meta charset="utf-8"><meta name="keywords" content="Docker入门系列  8. Docker 容器网络的概念及网络配置 macvlan"><meta name="description" content=""><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><meta name="renderer" content="webkit|ie-stand|ie-comp"><meta name="mobile-web-app-capable" content="yes"><meta name="format-detection" content="telephone=no"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-167468047-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-167468047-1")</script><title>Docker入门系列 8. Docker 容器网络的概念及网络配置 macvlan | 小白笔记</title><link rel="icon" type="image/png" href="/favicon.png"><link rel="stylesheet" href="/libs/awesome/css/all.css"><link rel="stylesheet" href="/libs/materialize/materialize.min.css"><link rel="stylesheet" href="/libs/aos/aos.css"><link rel="stylesheet" href="/libs/animate/animate.min.css"><link rel="stylesheet" href="/libs/lightGallery/css/lightgallery.min.css"><link rel="stylesheet" href="/css/matery.css"><link rel="stylesheet" href="/css/my.css"><script src="/libs/jquery/jquery.min.js"></script><meta name="generator" content="Hexo 4.2.0"><link rel="alternate" href="/atom.xml" title="小白笔记" type="application/atom+xml"><link rel="stylesheet" href="/css/prism-tomorrow.css"><link rel="stylesheet" href="/css/prism-line-numbers.css"></head><body><header class="navbar-fixed"><nav id="headNav" class="bg-color nav-transparent"><div id="navContainer" class="nav-wrapper container"><div class="brand-logo"><a href="/" class="waves-effect waves-light"><div><img src="/medias/loading.gif" data-original="/medias/logo.png" class="logo-img" alt="LOGO"> <span class="logo-span">小白笔记</span></div></a></div><a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fas fa-bars"></i></a><ul class="right nav-menu"><li class="hide-on-med-and-down nav-item"><a href="/" class="waves-effect waves-light"><i class="fas fa-home" style="zoom:.6"></i> <span>首页</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fas fa-tags" style="zoom:.6"></i> <span>标签</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fas fa-bookmark" style="zoom:.6"></i> <span>分类</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fas fa-archive" style="zoom:.6"></i> <span>归档</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/about" class="waves-effect waves-light"><i class="fas fa-user-circle" style="zoom:.6"></i> <span>关于</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fas fa-comments" style="zoom:.6"></i> <span>留言板</span></a></li><li class="hide-on-med-and-down nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fas fa-address-book" style="zoom:.6"></i> <span>友情链接</span></a></li><li><a href="#searchModal" class="modal-trigger waves-effect waves-light"><i id="searchIcon" class="fas fa-search" title="搜索" style="zoom:.85"></i></a></li></ul><div id="mobile-nav" class="side-nav sidenav"><div class="mobile-head bg-color"><img src="/medias/loading.gif" data-original="/medias/logo.png" class="logo-img circle responsive-img"><div class="logo-name">小白笔记</div><div class="logo-desc">Never really desperate, only the lost of the soul.</div></div><ul class="menu-list mobile-menu-list"><li class="m-nav-item"><a href="/" class="waves-effect waves-light"><i class="fa-fw fas fa-home"></i> 首页</a></li><li class="m-nav-item"><a href="/tags" class="waves-effect waves-light"><i class="fa-fw fas fa-tags"></i> 标签</a></li><li class="m-nav-item"><a href="/categories" class="waves-effect waves-light"><i class="fa-fw fas fa-bookmark"></i> 分类</a></li><li class="m-nav-item"><a href="/archives" class="waves-effect waves-light"><i class="fa-fw fas fa-archive"></i> 归档</a></li><li class="m-nav-item"><a href="/about" class="waves-effect waves-light"><i class="fa-fw fas fa-user-circle"></i> 关于</a></li><li class="m-nav-item"><a href="/contact" class="waves-effect waves-light"><i class="fa-fw fas fa-comments"></i> 留言板</a></li><li class="m-nav-item"><a href="/friends" class="waves-effect waves-light"><i class="fa-fw fas fa-address-book"></i> 友情链接</a></li><li><div class="divider"></div></li><li><a href="https://github.com/baymax-tips" class="waves-effect waves-light" target="_blank"><i class="fab fa-github-square fa-fw"></i> Fork Me</a></li></ul></div></div><style>.nav-transparent .github-corner{display:none!important}.github-corner{position:absolute;z-index:10;top:0;right:0;border:0;transform:scale(1.1)}.github-corner svg{color:#0f9d58;fill:#fff;height:64px;width:64px}.github-corner:hover .octo-arm{animation:a .56s ease-in-out}.github-corner .octo-arm{animation:none}@keyframes a{0%,to{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}</style><a href="https://github.com/baymax-tips" class="github-corner tooltipped hide-on-med-and-down" target="_blank" data-tooltip="Fork Me" data-position="left" data-delay="50"><svg viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a></nav></header><div class="bg-cover pd-header post-cover" style="background-image:url(/medias/featureimages/0.jpg)"><div class="container" style="right:0;left:0"><div class="row"><div class="col s12 m12 l12"><div class="brand"><h1 class="description center-align post-title">Docker入门系列 8. Docker 容器网络的概念及网络配置 macvlan</h1></div></div></div></div></div><main class="post-container content"><link rel="stylesheet" href="/libs/tocbot/tocbot.css"><style>#articleContent h1::before,#articleContent h2::before,#articleContent h3::before,#articleContent h4::before,#articleContent h5::before,#articleContent h6::before{display:block;content:" ";height:100px;margin-top:-100px;visibility:hidden}#articleContent :focus{outline:0}.toc-fixed{position:fixed;top:64px}.toc-widget{width:345px;padding-left:20px}.toc-widget .toc-title{margin:35px 0 15px 0;padding-left:17px;font-size:1.5rem;font-weight:700;line-height:1.5rem}.toc-widget ol{padding:0;list-style:none}#toc-content{height:calc(100vh - 250px);overflow:auto}#toc-content ol{padding-left:10px}#toc-content ol li{padding-left:10px}#toc-content .toc-link:hover{color:#42b983;font-weight:700;text-decoration:underline}#toc-content .toc-link::before{background-color:transparent;max-height:25px;position:absolute;right:23.5vw;display:block}#toc-content .is-active-link{color:#42b983}#floating-toc-btn{position:fixed;right:15px;bottom:76px;padding-top:15px;margin-bottom:0;z-index:998}#floating-toc-btn .btn-floating{width:48px;height:48px}#floating-toc-btn .btn-floating i{line-height:48px;font-size:1.4rem}</style><div class="row"><div id="main-content" class="col s12 m12 l9"><div id="artDetail"><div class="card"><div class="card-content article-info"><div class="row tag-cate"><div class="col s7"><div class="article-tag"><a href="/tags/Docker/"><span class="chip bg-color">Docker</span></a> <a href="/tags/%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1/"><span class="chip bg-color">容器服务</span></a></div></div><div class="col s5 right-align"><div class="post-cate"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1/" class="post-category">容器服务</a></div></div></div><div class="post-info"><div class="post-date info-break-policy"><i class="far fa-calendar-minus fa-fw"></i> 发布日期:&nbsp;&nbsp; 2020-05-25</div><div class="info-break-policy"><i class="far fa-file-word fa-fw"></i> 文章字数:&nbsp;&nbsp; 2k</div><div class="info-break-policy"><i class="far fa-clock fa-fw"></i> 阅读时长:&nbsp;&nbsp; 8 分</div><div id="busuanzi_container_page_pv" class="info-break-policy"><i class="far fa-eye fa-fw"></i> 阅读次数:&nbsp;&nbsp;<span id="busuanzi_value_page_pv"></span></div></div></div><hr class="clearfix"><div class="card-content article-card-content"><div id="articleContent"><h2 id="1-使用-macvlan-网络"><a href="#1-使用-macvlan-网络" class="headerlink" title="1. 使用 macvlan 网络"></a>1. 使用 macvlan 网络</h2><p>有些应用程序，特别是监视网络流量的遗留应用程序或应用程序，希望直接连接到物理网络。 在这种情况下，你可以使用 macvlan 网络驱动程序为每个容器的虚拟网络接口分配一个 MAC 地址，使其看起来像一个直接连接到物理网络的物理网络接口。 在这种情况下，您需要在 Docker 主机上指定一个用于 macvlan 的物理接口，以及 macvlan 的子网和网关。 您甚至可以使用不同的物理网络接口来隔离您的 macvlan 网络。 记住以下几点:</p><ul><li><p>由于 IP 地址耗尽或“ VLAN 扩散” ，很容易无意中损坏您的网络，这种情况下，您的网络中有大量不适当的唯一 MAC 地址。</p></li><li><p>你的网络设备需要能够处理“混杂模式” ，其中一个物理接口可以分配多个 MAC 地址。</p></li><li><p>如果您的应用程序可以使用网桥(在单个 Docker 主机上)或覆盖(跨多个 Docker 主机通信) ，那么从长远来看，这些解决方案可能更好。</p></li></ul><h3 id="1-1-创建一个-macvlan-网络"><a href="#1-1-创建一个-macvlan-网络" class="headerlink" title="1.1 创建一个 macvlan 网络"></a>1.1 创建一个 macvlan 网络</h3><p>当您创建 macvlan 网络时，它可以是桥接模式或802.1 q vlan 桥接模式。</p><ul><li><p>在桥接模式下，macvlan 流量通过主机上的一个物理设备。</p></li><li><p>在802.1 q vlan 桥模式下，流量通过 Docker 动态创建的802.1 q 子接口。 这允许您在更细粒度的级别上控制路由和过滤。</p></li></ul><h3 id="1-2-桥接模式"><a href="#1-2-桥接模式" class="headerlink" title="1.2 桥接模式"></a>1.2 桥接模式</h3><p>要创建一个连接给定物理网络接口的 macvlan 网络，可以使用 <code>--driver macvlan</code> 和 <code>docker network create</code> 命令。 您还需要指定父接口，它是流量将在 Docker 主机上物理地经过的接口。</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker network create -d macvlan \
  --subnet<span class="token operator">=</span>172.16.86.0/24 \
  --gateway<span class="token operator">=</span>172.16.86.1 \
  -o parent<span class="token operator">=</span>eth0 pub_net<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>如果你需要排除在 macvlan 网络中使用的 IP 地址，比如当一个给定的 IP 地址已经在使用时，使用 – aux-addresses:</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker network create -d macvlan \
  --subnet<span class="token operator">=</span>192.168.32.0/24 \
  --ip-range<span class="token operator">=</span>192.168.32.128/25 \
  --gateway<span class="token operator">=</span>192.168.32.254 \
  --aux-address<span class="token operator">=</span><span class="token string">"my-router=192.168.32.129"</span> \
  -o parent<span class="token operator">=</span>eth0 macnet32<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-3-集束桥接模式（vlan）"><a href="#1-3-集束桥接模式（vlan）" class="headerlink" title="1.3 集束桥接模式（vlan）"></a>1.3 集束桥接模式（vlan）</h3><p>如果您指定父接口名称并包含一个点，例如 eth0.50，Docker 将其解释为 eth0的子接口，并自动创建子接口。</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker network create -d macvlan \
    --subnet<span class="token operator">=</span>192.168.50.0/24 \
    --gateway<span class="token operator">=</span>192.168.50.1 \
    -o parent<span class="token operator">=</span>eth0.50 macvlan50<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-4-使用-ipvlan-而不是-macvlan"><a href="#1-4-使用-ipvlan-而不是-macvlan" class="headerlink" title="1.4 使用 ipvlan 而不是 macvlan"></a>1.4 使用 ipvlan 而不是 macvlan</h3><p>在上面的示例中，您仍然在使用 L3桥。 你可以使用 ipvlan 代替，并得到一个 L2桥。 指定 -o ipvlan 模式 l2。</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker network create -d ipvlan \
    --subnet<span class="token operator">=</span>192.168.210.0/24 \
    --subnet<span class="token operator">=</span>192.168.212.0/24 \
    --gateway<span class="token operator">=</span>192.168.210.254 \
    --gateway<span class="token operator">=</span>192.168.212.254 \
     -o ipvlan_mode<span class="token operator">=</span>l2 ipvlan210<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="1-5-使用-IPv6"><a href="#1-5-使用-IPv6" class="headerlink" title="1.5 使用 IPv6"></a>1.5 使用 IPv6</h3><p>如果已经将 Docker 守护进程配置为允许 IPv6，则可以使用双栈 ipv4 / IPv6 macvlan 网络。</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker network create -d macvlan \
    --subnet<span class="token operator">=</span>192.168.216.0/24 --subnet<span class="token operator">=</span>192.168.218.0/24 \
    --gateway<span class="token operator">=</span>192.168.216.1 --gateway<span class="token operator">=</span>192.168.218.1 \
    --subnet<span class="token operator">=</span>2001:db8:abc8::/64 --gateway<span class="token operator">=</span>2001:db8:abc8::10 \
     -o parent<span class="token operator">=</span>eth0.218 \
     -o macvlan_mode<span class="token operator">=</span>bridge macvlan216<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="2-实践练习-macvlan-网络"><a href="#2-实践练习-macvlan-网络" class="headerlink" title="2. 实践练习 macvlan 网络"></a>2. 实践练习 macvlan 网络</h2><p>该实践处理网络独立的容器连接到 macvlan 网络。 在这种类型的网络中，Docker 主机在其 IP 地址接受对多个 MAC 地址的请求，并将这些请求路由到适当的容器。</p><h3 id="2-1-目标"><a href="#2-1-目标" class="headerlink" title="2.1 目标"></a>2.1 目标</h3><p>目标是建立一个桥接 macvlan 网络和附加一个容器到它，然后建立一个802.1 q 集束聚合 macvlan 网络和附加一个容器到它。</p><h3 id="2-2-先决条件"><a href="#2-2-先决条件" class="headerlink" title="2.2 先决条件"></a>2.2 先决条件</h3><ul><li><p>大多数云提供商都会屏蔽 macvlan 网络，您可能需要对网络设备进行物理访问。</p></li><li><p>Macvlan 网络驱动程序只能在 Linux 主机上使用，而且不支持 Docker Desktop for Mac，Docker Desktop for Windows，或 Docker EE for Windows Server。</p></li><li><p>您至少需要3.9版本的 Linux 内核，并且推荐4.0或更高版本。</p></li><li><p>这些例子假设您的以太网接口是 eth0。如果您的设备有一个不同的名称，请使用相应的名称。</p></li></ul><h3 id="2-3-桥接模式"><a href="#2-3-桥接模式" class="headerlink" title="2.3 桥接模式"></a>2.3 桥接模式</h3><p>在简单的桥接示例中，流量通过 eth0和 Docker 使用容器的 MAC 地址将流量路由到容器。 对于网络上的网络设备，容器看起来是物理连接到网络的。</p><ol><li><p>创建一个称为 my-macvlan-net 的 macvlan 网络。 将子网、网关和父值修改为在环境中有意义的值。</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker network create -d macvlan \
--subnet<span class="token operator">=</span>172.16.86.0/24 \
--gateway<span class="token operator">=</span>172.16.86.1 \
-o parent<span class="token operator">=</span>eth0 \
my-macvlan-net<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>您可以使用 docker 网络 ls 和 docker 网络检查 my-macvlan-net 命令，以验证网络存在并且是 macvlan 网络。</p></li><li><p>启动一个<code>alpine</code>容器并将其连接到 <code>my-macvlan-net</code> 网络。 <code>-dit</code> 标志在后台启动容器，但允许您附加到它。 <code>-rm</code> 标志意味着容器在停止时被移除。</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker run --rm -itd \
--network my-macvlan-net \
--name my-macvlan-alpine \
alpine:latest \
ash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>检查 <code>my-macvlan-alpine</code> 容器，注意网络键中的 <code>MacAddress</code> 键:</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker container inspect my-macvlan-alpine

<span class="token punctuation">..</span>.truncated<span class="token punctuation">..</span>.
<span class="token string">"Networks"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
<span class="token string">"my-macvlan-net"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
   <span class="token string">"IPAMConfig"</span><span class="token keyword">:</span> null,
   <span class="token string">"Links"</span><span class="token keyword">:</span> null,
   <span class="token string">"Aliases"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
       <span class="token string">"bec64291cd4c"</span>
   <span class="token punctuation">]</span>,
   <span class="token string">"NetworkID"</span><span class="token keyword">:</span> <span class="token string">"5e3ec79625d388dbcc03dcf4a6dc4548644eb99d58864cf8eee2252dcfc0cc9f"</span>,
   <span class="token string">"EndpointID"</span><span class="token keyword">:</span> <span class="token string">"8caf93c862b22f379b60515975acf96f7b54b7cf0ba0fb4a33cf18ae9e5c1d89"</span>,
   <span class="token string">"Gateway"</span><span class="token keyword">:</span> <span class="token string">"172.16.86.1"</span>,
   <span class="token string">"IPAddress"</span><span class="token keyword">:</span> <span class="token string">"172.16.86.2"</span>,
   <span class="token string">"IPPrefixLen"</span><span class="token keyword">:</span> 24,
   <span class="token string">"IPv6Gateway"</span><span class="token keyword">:</span> <span class="token string">""</span>,
   <span class="token string">"GlobalIPv6Address"</span><span class="token keyword">:</span> <span class="token string">""</span>,
   <span class="token string">"GlobalIPv6PrefixLen"</span><span class="token keyword">:</span> 0,
   <span class="token string">"MacAddress"</span><span class="token keyword">:</span> <span class="token string">"02:42:ac:10:56:02"</span>,
   <span class="token string">"DriverOpts"</span><span class="token keyword">:</span> null
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">..</span>.truncated<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>通过运行两个 docker exec 命令，查看容器如何看待自己的网络接口。</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker <span class="token function">exec</span> my-macvlan-alpine ip addr show eth0

9: eth0@tunl0: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">></span> mtu 1500 qdisc noqueue state UP
link/ether 02:42:ac:10:56:02 brd ff:ff:ff:ff:ff:ff
inet 172.16.86.2/24 brd 172.16.86.255 scope global eth0
valid_lft forever preferred_lft forever<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash"><code class="language-bash">$ docker <span class="token function">exec</span> my-macvlan-alpine ip route

default via 172.16.86.1 dev eth0
172.16.86.0/24 dev eth0 scope <span class="token function">link</span>  src 172.16.86.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>停止容器(因为 <code>--rm</code> 标志，Docker 删除了它) ，并删除网络。</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker container stop my-macvlan-alpine

$ docker network <span class="token function">rm</span> my-macvlan-net<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol><h3 id="2-4-集束桥接（vlan）"><a href="#2-4-集束桥接（vlan）" class="headerlink" title="2.4 集束桥接（vlan）"></a>2.4 集束桥接（vlan）</h3><p>在802.1 q 集束桥接的示例中，流量通过 eth0(称为 eth0.10)的子接口流动，而 Docker 使用容器的 MAC 地址将流量路由到容器。 对于网络上的网络设备，容器看起来是物理连接到网络的。</p><ol><li><p>创建一个名为 my-8021q-macvlan-net 的 macvlan 网络。 将子网、网关和父值修改为在环境中有意义的值。</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker network create -d macvlan \
--subnet<span class="token operator">=</span>172.16.86.0/24 \
--gateway<span class="token operator">=</span>172.16.86.1 \
-o parent<span class="token operator">=</span>eth0.10 \
my-8021q-macvlan-net<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>您可以使用 <code>docker network ls</code> 和 <code>docker network inspection my-8021q-macvlan-net</code> 命令来验证网络是否存在，是否是 <code>macvlan</code> 网络，以及是否具有父 <code>eth0.10</code>。 您可以在 Docker 主机上使用 <code>ip addr show</code> 来验证接口 <code>eth0.10</code>是否存在并具有单独的 IP 地址</p></li><li><p>启动一个<code>alpine</code>容器并将其连接到 <code>my-8021q-macvlan-net</code> 网络。 <code>-dit</code> 标志在后台启动容器，但允许您附加到它。 <code>-rm</code> 标志意味着容器在停止时被移除。</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker run --rm -itd \
--network my-8021q-macvlan-net \
--name my-second-macvlan-alpine \
alpine:latest \
ash<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>检查 <code>my-second-macvlan-alpine</code> 容器，注意网络键中的 <code>MacAddress</code> 键:</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker container inspect my-second-macvlan-alpine

<span class="token punctuation">..</span>.truncated<span class="token punctuation">..</span>.
<span class="token string">"Networks"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
<span class="token string">"my-8021q-macvlan-net"</span><span class="token keyword">:</span> <span class="token punctuation">{</span>
   <span class="token string">"IPAMConfig"</span><span class="token keyword">:</span> null,
   <span class="token string">"Links"</span><span class="token keyword">:</span> null,
   <span class="token string">"Aliases"</span><span class="token keyword">:</span> <span class="token punctuation">[</span>
       <span class="token string">"12f5c3c9ba5c"</span>
   <span class="token punctuation">]</span>,
   <span class="token string">"NetworkID"</span><span class="token keyword">:</span> <span class="token string">"c6203997842e654dd5086abb1133b7e6df627784fec063afcbee5893b2bb64db"</span>,
   <span class="token string">"EndpointID"</span><span class="token keyword">:</span> <span class="token string">"aa08d9aa2353c68e8d2ae0bf0e11ed426ea31ed0dd71c868d22ed0dcf9fc8ae6"</span>,
   <span class="token string">"Gateway"</span><span class="token keyword">:</span> <span class="token string">"172.16.86.1"</span>,
   <span class="token string">"IPAddress"</span><span class="token keyword">:</span> <span class="token string">"172.16.86.2"</span>,
   <span class="token string">"IPPrefixLen"</span><span class="token keyword">:</span> 24,
   <span class="token string">"IPv6Gateway"</span><span class="token keyword">:</span> <span class="token string">""</span>,
   <span class="token string">"GlobalIPv6Address"</span><span class="token keyword">:</span> <span class="token string">""</span>,
   <span class="token string">"GlobalIPv6PrefixLen"</span><span class="token keyword">:</span> 0,
   <span class="token string">"MacAddress"</span><span class="token keyword">:</span> <span class="token string">"02:42:ac:10:56:02"</span>,
   <span class="token string">"DriverOpts"</span><span class="token keyword">:</span> null
<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token punctuation">..</span>.truncated<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>通过运行两个 docker exec 命令，查看容器如何看待自己的网络接口。</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker <span class="token function">exec</span> my-second-macvlan-alpine ip addr show eth0

11: eth0@if10: <span class="token operator">&lt;</span>BROADCAST,MULTICAST,UP,LOWER_UP,M-DOWN<span class="token operator">></span> mtu 1500 qdisc noqueue state UP
link/ether 02:42:ac:10:56:02 brd ff:ff:ff:ff:ff:ff
inet 172.16.86.2/24 brd 172.16.86.255 scope global eth0
valid_lft forever preferred_lft forever<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-bash"><code class="language-bash">$ docker <span class="token function">exec</span> my-second-macvlan-alpine ip route

default via 172.16.86.1 dev eth0
172.16.86.0/24 dev eth0 scope <span class="token function">link</span>  src 172.16.86.2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></li><li><p>停止容器(因为 – rm 标志，Docker 删除了它) ，并删除网络。</p><pre class="line-numbers language-bash"><code class="language-bash">$ docker container stop my-second-macvlan-alpine

$ docker network <span class="token function">rm</span> my-8021q-macvlan-net<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></li></ol><script>document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });</script></div><hr><div class="reprint" id="reprint-statement"><div class="reprint__author"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-user">文章作者:</i></span> <span class="reprint-info"><a href="/about" rel="external nofollow noreferrer">Baymax</a></span></div><div class="reprint__type"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-link">文章链接:</i></span> <span class="reprint-info"><a href="https://baymax.tips/posts/38417.html">https://baymax.tips/posts/38417.html</a></span></div><div class="reprint__notice"><span class="reprint-meta" style="font-weight:700"><i class="fas fa-copyright">版权声明:</i></span> <span class="reprint-info">本博客所有文章除特別声明外，均采用 <a href="https://creativecommons.org/licenses/by/4.0/deed.zh" rel="external nofollow noreferrer" target="_blank">CC BY 4.0</a> 许可协议。转载请注明来源 <a href="/about" target="_blank">Baymax</a> !</span></div></div><script async defer>document.addEventListener("copy", function (e) {
        let toastHTML = '<span>复制成功，请遵循本文的转载规则</span><button class="btn-flat toast-action" onclick="navToReprintStatement()" style="font-size: smaller">查看</a>';
        M.toast({html: toastHTML})
      });

      function navToReprintStatement() {
        $("html, body").animate({scrollTop: $("#reprint-statement").offset().top - 80}, 800);
      }</script><div class="tag_share" style="display:block"><div class="post-meta__tag-list" style="display:inline-block"><div class="article-tag"><a href="/tags/Docker/"><span class="chip bg-color">Docker</span></a> <a href="/tags/%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1/"><span class="chip bg-color">容器服务</span></a></div></div><div class="post_share" style="zoom:80%;width:fit-content;display:inline-block;float:right;margin:-.15rem 0"><link rel="stylesheet" href="/libs/share/css/share.min.css"><div id="article-share"><div class="social-share" data-sites="twitter,facebook,google,qq,qzone,wechat,weibo,douban,linkedin" data-wechat-qrcode-helper="<p>微信扫一扫即可分享！</p>"></div><script src="/libs/share/js/social-share.min.js"></script></div></div></div><style>#reward{margin:40px 0;text-align:center}#reward .reward-link{font-size:1.4rem;line-height:38px}#reward .btn-floating:hover{box-shadow:0 6px 12px rgba(0,0,0,.2),0 5px 15px rgba(0,0,0,.2)}#rewardModal{width:320px;height:350px}#rewardModal .reward-title{margin:15px auto;padding-bottom:5px}#rewardModal .modal-content{padding:10px}#rewardModal .close{position:absolute;right:15px;top:15px;color:rgba(0,0,0,.5);font-size:1.3rem;line-height:20px;cursor:pointer}#rewardModal .close:hover{color:#ef5350;transform:scale(1.3);-moz-transform:scale(1.3);-webkit-transform:scale(1.3);-o-transform:scale(1.3)}#rewardModal .reward-tabs{margin:0 auto;width:210px}.reward-tabs .tabs{height:38px;margin:10px auto;padding-left:0}.reward-content ul{padding-left:0!important}.reward-tabs .tabs .tab{height:38px;line-height:38px}.reward-tabs .tab a{color:#fff;background-color:#ccc}.reward-tabs .tab a:hover{background-color:#ccc;color:#fff}.reward-tabs .wechat-tab .active{color:#fff!important;background-color:#22ab38!important}.reward-tabs .alipay-tab .active{color:#fff!important;background-color:#019fe8!important}.reward-tabs .reward-img{width:210px;height:210px}</style><div id="reward"><a href="#rewardModal" class="reward-link modal-trigger btn-floating btn-medium waves-effect waves-light red">赏</a><div id="rewardModal" class="modal"><div class="modal-content"><a class="close modal-close"><i class="fas fa-times"></i></a><h4 class="reward-title">你的赏识是我前进的动力</h4><div class="reward-content"><div class="reward-tabs"><ul class="tabs row"><li class="tab col s6 alipay-tab waves-effect waves-light"><a href="#alipay">支付宝</a></li><li class="tab col s6 wechat-tab waves-effect waves-light"><a href="#wechat">微 信</a></li></ul><div id="alipay"><img src="/medias/loading.gif" data-original="/medias/reward/alipay.jpg" class="reward-img" alt="支付宝打赏二维码"></div><div id="wechat"><img src="/medias/loading.gif" data-original="/medias/reward/wechat.png" class="reward-img" alt="微信打赏二维码"></div></div></div></div></div></div><script>$(function(){$(".tabs").tabs()})</script></div></div><link rel="stylesheet" href="/libs/gitalk/gitalk.css"><link rel="stylesheet" href="/css/my-gitalk.css"><div class="card gitalk-card" data-aos="fade-up"><div class="comment_headling" style="font-size:20px;font-weight:700;position:relative;padding-left:20px;top:15px;padding-bottom:5px"><i class="fas fa-comments fa-fw" aria-hidden="true"></i> <span>评论</span></div><div id="gitalk-container" class="card-content"></div></div><script src="/libs/gitalk/gitalk.min.js"></script><script>let gitalk = new Gitalk({
        clientID: '409bf7f6a2a9bcc0f9e6',
        clientSecret: '1cafe266ac7e32c87692df3d52b9a16b773e8c31',
        repo: 'baymax-tips.github.io',
        owner: 'baymax-tips',
        admin: "baymax-tips",
        id: '2020-05-25T19-44-52',
        distractionFreeMode: false  // Facebook-like distraction free mode
    });

    gitalk.render('gitalk-container');</script><article id="prenext-posts" class="prev-next articles"><div class="row article-row"><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge left-badge text-color"><i class="fas fa-chevron-left"></i> &nbsp;上一篇</div><div class="card"><a href="/posts/37415.html"><div class="card-image"><img src="/medias/loading.gif" data-original="/medias/featureimages/10.jpg" class="responsive-img" alt="Docker入门系列  9. Docker 容器的数据管理  数据卷 绑定挂载 临时挂载"> <span class="card-title">Docker入门系列 9. Docker 容器的数据管理 数据卷 绑定挂载 临时挂载</span></div></a><div class="card-content article-content"><div class="summary block-with-text">因为容器技术，重新构建并运行应用变得容易且快速，容器化应用基本是无需进一步配置的（已经打包好所有依赖并且已配置），只需PULL，然后Deploy（也许还需要一份docker-compose.yml）就好。我们无需太担心硬件，OS，库以及应用</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2020-05-25</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1/" class="post-category">容器服务</a></span></div></div><div class="card-action article-tags"><a href="/tags/Docker/"><span class="chip bg-color">Docker</span></a> <a href="/tags/%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1/"><span class="chip bg-color">容器服务</span></a></div></div></div><div class="article col s12 m6" data-aos="fade-up"><div class="article-badge right-badge text-color">下一篇&nbsp;<i class="fas fa-chevron-right"></i></div><div class="card"><a href="/posts/42665.html"><div class="card-image"><img src="/medias/loading.gif" data-original="/medias/featureimages/5.jpg" class="responsive-img" alt="Docker入门系列  7. Docker 容器网络的概念及网络配置 主机网络"> <span class="card-title">Docker入门系列 7. Docker 容器网络的概念及网络配置 主机网络</span></div></a><div class="card-content article-content"><div class="summary block-with-text">1. 使用主机网络如果您使用容器的主机网络模式，那么容器的网络堆栈不会与 Docker 主机隔离(容器共享主机的网络名称空间) ，并且容器不会得到自己的 ip 地址分配。 例如，如果您运行一个绑定到端口80的容器，并且使用主机网络，那么容器</div><div class="publish-info"><span class="publish-date"><i class="far fa-clock fa-fw icon-date"></i> 2020-05-25</span><span class="publish-author"><i class="fas fa-bookmark fa-fw icon-category"></i> <a href="/categories/%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1/" class="post-category">容器服务</a></span></div></div><div class="card-action article-tags"><a href="/tags/Docker/"><span class="chip bg-color">Docker</span></a> <a href="/tags/%E5%AE%B9%E5%99%A8%E6%9C%8D%E5%8A%A1/"><span class="chip bg-color">容器服务</span></a></div></div></div></div></article></div><script src="/libs/codeBlock/codeBlockFuction.js"></script><script src="/libs/codeBlock/codeLang.js"></script><script src="/libs/codeBlock/codeCopy.js"></script><script src="/libs/codeBlock/codeShrink.js"></script><style>code[class*=language-],pre[class*=language-]{white-space:pre!important}</style></div><div id="toc-aside" class="expanded col l3 hide-on-med-and-down"><div class="toc-widget"><div class="toc-title"><i class="far fa-list-alt"></i>&nbsp;&nbsp;目录</div><div id="toc-content"></div></div></div></div><div id="floating-toc-btn" class="hide-on-med-and-down"><a class="btn-floating btn-large bg-color"><i class="fas fa-list-ul"></i></a></div><script src="/libs/tocbot/tocbot.min.js"></script><script>$(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            collapseDepth: Number('0'),
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).hide();
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).show();
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });</script></main><footer class="page-footer bg-color"><link rel="stylesheet" href="/libs/aplayer/APlayer.min.css"><style>.aplayer .aplayer-lrc p{display:none;font-size:12px;font-weight:700;line-height:16px!important}.aplayer .aplayer-lrc p.aplayer-lrc-current{display:none;font-size:15px;color:#42b983}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body{left:-66px!important}.aplayer.aplayer-fixed.aplayer-narrow .aplayer-body:hover{left:0!important}</style><div><div class="row"><meting-js class="col l8 offset-l2 m10 offset-m1 s12" server="netease" type="playlist" id="503838841" fixed="true" autoplay theme="#42b983" loop order="random" preload="auto" volume="0.7" list-folded="true"></meting-js></div></div><script src="/libs/aplayer/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/meting@2/dist/Meting.min.js"></script><div class="container row center-align" style="margin-bottom:0!important"><div class="col s12 m8 l8 copy-right">Copyright&nbsp;&copy; <span id="year">2019</span> <a href="/about" target="_blank">Baymax</a> |&nbsp;Powered by&nbsp;<a href="https://hexo.io/" target="_blank">Hexo</a> |&nbsp;Theme&nbsp;<a href="https://github.com/blinkfox/hexo-theme-matery" target="_blank">Matery</a><br><span id="busuanzi_container_site_pv">|&nbsp;<i class="far fa-eye"></i>&nbsp;总访问量:&nbsp;<span id="busuanzi_value_site_pv" class="white-color"></span>&nbsp;次</span> <span id="busuanzi_container_site_uv">|&nbsp;<i class="fas fa-users"></i>&nbsp;总访问人数:&nbsp;<span id="busuanzi_value_site_uv" class="white-color"></span>&nbsp;人</span><br><br></div><div class="col s12 m4 l4 social-link social-statis"><a href="https://github.com/baymax-tips" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50"><i class="fab fa-github"></i></a><a href="mailto:baymax.tips@gmail.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50"><i class="fas fa-envelope-open"></i></a><a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=1104559822" class="tooltipped" target="_blank" data-tooltip="QQ联系我: 1104559822" data-position="top" data-delay="50"><i class="fab fa-qq"></i></a><a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50"><i class="fas fa-rss"></i></a></div></div></footer><div class="progress-bar"></div><div id="searchModal" class="modal"><div class="modal-content"><div class="search-header"><span class="title"><i class="fas fa-search"></i> &nbsp;&nbsp;搜索</span> <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字" class="search-input"></div><div id="searchResult"></div></div></div><script src="/js/search.js"></script><script>$(function(){searchFunc("/search.xml","searchInput","searchResult")})</script><div id="backTop" class="top-scroll"><a class="btn-floating btn-large waves-effect waves-light" href="#!"><i class="fas fa-arrow-up"></i></a></div><script src="/libs/materialize/materialize.min.js"></script><script src="/libs/masonry/masonry.pkgd.min.js"></script><script src="/libs/aos/aos.js"></script><script src="/libs/scrollprogress/scrollProgress.min.js"></script><script src="/libs/lightGallery/js/lightgallery-all.min.js"></script><script src="/js/matery.js"></script><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?0c003470f128eba63e9f505647bc17bd";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/libs/others/clicklove.js" async></script><script async src="/libs/others/busuanzi.pure.mini.js"></script><script src="/libs/background/ribbon-dynamic.js" async></script><script src="/libs/instantpage/instantpage.js" type="module"></script><script>window.imageLazyLoadSetting={isSPA:!1,processImages:null}</script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})})</script><script>!function(n){n.imageLazyLoadSetting.processImages=i;var e=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=r[a].getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight+240||document.documentElement.clientHeight+240)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e()},n.src=i}()}i(),n.addEventListener("scroll",function(){var t,e;t=i,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this)</script></body></html>